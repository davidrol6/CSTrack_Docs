

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>generate_utils &mdash; CSTrack 05-08-2021 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
  <link rel="stylesheet" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
  <link rel="stylesheet" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> CSTrack
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Project documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../inputs.html">Input data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../inputs.html#tweet-dataset">Tweet dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../inputs.html#database-connections">Database connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../inputs.html#bert-model">BERT model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../inputs.html#final-considerations">Final considerations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#standard-deployment">Standard deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#docker-deployment">Docker deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#running-the-application">Running the application</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dash_cs.html">Main application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dash_cs.html#standalone">Standalone</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dash_cs.html#within-flask">Within Flask</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utilities.html">Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../berttopic_utils.html">Bertopic utilities module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../communities_utils.html">Community calculation module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dash_utils.html">Figure generation module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generate_utils.html">Input formatting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../map_utils.html">Geomap utilities module</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about.html#acknowledgements">Acknowledgements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#contact">Contact</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../institutions.html">Participating institutions</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CSTrack</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>generate_utils</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for generate_utils</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">from</span> <span class="nn">wordcloud</span> <span class="kn">import</span> <span class="n">WordCloud</span><span class="p">,</span> <span class="n">STOPWORDS</span><span class="p">,</span> <span class="n">ImageColorGenerator</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">subplots</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">vaderSentiment.vaderSentiment</span> <span class="kn">import</span> <span class="n">SentimentIntensityAnalyzer</span>

<span class="c1"># stop_words para emplear en filtrados:</span>

<span class="n">stop_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">]</span>

<span class="c1"># Function to create a bargraph:</span>

<div class="viewcode-block" id="plotbarchart"><a class="viewcode-back" href="../generate_utils.html#generate_utils.plotbarchart">[docs]</a><span class="k">def</span> <span class="nf">plotbarchart</span><span class="p">(</span><span class="n">numberbars</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a number of elements to plot and the elements in x and y axis the function returns a barchart</span>

<span class="sd">    :param numberbars: Number of elements to plot in the chart</span>
<span class="sd">    :param x: Elements for x axis</span>
<span class="sd">    :param y: Elements for y axis, number of appearances of the x elements</span>
<span class="sd">    :param title: Title for the figure, defaults to None</span>
<span class="sd">    :param xlabel: Label for the x axis, defaults to None</span>
<span class="sd">    :param ylabel: Label for the y axis, defaults to None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="n">numberbars</span><span class="p">],</span> <span class="n">y</span><span class="p">[:</span><span class="n">numberbars</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightsteelblue&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span></div>

<div class="viewcode-block" id="scatterplot"><a class="viewcode-back" href="../generate_utils.html#generate_utils.scatterplot">[docs]</a><span class="k">def</span> <span class="nf">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given the elements for x axis and the number of the elements for y axis the function returns a scatterplot</span>

<span class="sd">    :param x: Elements for the x axis</span>
<span class="sd">    :param y: Elements for the y axis, number of appearances of the x elements</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;lightsteelblue&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Indegree&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Outdegree&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<span class="c1"># Función para obtener los subgrafos con NetworkX:</span>

<div class="viewcode-block" id="get_subgraphs"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_subgraphs">[docs]</a><span class="k">def</span> <span class="nf">get_subgraphs</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a networkx Graph the function returns the subgraphs stored in a list</span>

<span class="sd">    :param graph: Networkx undirected graph</span>
<span class="sd">    :return: list of subgraphs as networkx objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">components</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">graph</span><span class="p">))</span>
    <span class="n">list_subgraphs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
        <span class="n">list_subgraphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">component</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">list_subgraphs</span></div>

<span class="c1"># Función para convertir a direct graph los subgrafos:</span>

<span class="sd">&#39;&#39;&#39;def make_weightedDiGraph(ejes):</span>
<span class="sd">    edges_tupla = [tuple(x) for x in ejes]</span>
<span class="sd">    G = nx.DiGraph((x, y, {&#39;weight&#39;: v}) for (x, y), v in Counter(edges_tupla).items())</span>
<span class="sd">    return G&#39;&#39;&#39;</span>

<span class="c1"># Converts subgraphs to direct graphs:</span>

<div class="viewcode-block" id="direct_subgraphs"><a class="viewcode-back" href="../generate_utils.html#generate_utils.direct_subgraphs">[docs]</a><span class="k">def</span> <span class="nf">direct_subgraphs</span><span class="p">(</span><span class="n">subgraphs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a networkx undirected list of subgraph the function returns all the graphs as directed</span>

<span class="sd">    :param subgraphs: List of undirected networkx subgraphs</span>
<span class="sd">    :return: List of directed subgraphs as networkx objects</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">list_directsubgraphs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subgraphs</span><span class="p">)):</span>
        <span class="n">list_directsubgraphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subgraphs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">to_directed</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">list_directsubgraphs</span></div>

<span class="c1"># Función para filtrar usando el topic que nos interese:</span>

<div class="viewcode-block" id="filter_by_topic"><a class="viewcode-back" href="../generate_utils.html#generate_utils.filter_by_topic">[docs]</a><span class="k">def</span> <span class="nf">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a DataFrame the function returns the dataframe filtered according the given keywords and stopwords</span>

<span class="sd">    :param df: Dataframe with all the tweets</span>
<span class="sd">    :param keywords: List of words acting as key to filter the dataframe</span>
<span class="sd">    :param stopwords: List of words destined to filter out the tweets containing them</span>
<span class="sd">    :return: DataFrame with the tweets containing the keywords</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">keywords</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keywords</span><span class="p">),</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">stopwords</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stopwords</span><span class="p">),</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">df</span></div>

<span class="c1"># Funcition to filter by subtopic:</span>

<div class="viewcode-block" id="filter_by_subtopic"><a class="viewcode-back" href="../generate_utils.html#generate_utils.filter_by_subtopic">[docs]</a><span class="k">def</span> <span class="nf">filter_by_subtopic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords2</span><span class="p">,</span> <span class="n">stopwords2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a previously filtered DataFrame the function returns the dataframe filtered according to the new subtopic of interest</span>

<span class="sd">    :param keywords2: List of words acting as key to filter the dataframe</span>
<span class="sd">    :param stopwords2: List of words destined to filter out the tweets that contain them</span>
<span class="sd">    :return: DataFrame with the tweets containing the keywords</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">keywords2</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keywords2</span><span class="p">),</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">stopwords2</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stopwords2</span><span class="p">),</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">df</span></div>

<span class="c1"># Function to filter by interest:</span>

<div class="viewcode-block" id="filter_by_interest"><a class="viewcode-back" href="../generate_utils.html#generate_utils.filter_by_interest">[docs]</a><span class="k">def</span> <span class="nf">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a non filtered DataFrame the function returns the dataframe filtered by the column interest</span>

<span class="sd">    :param df: DataFrame with all the tweets</span>
<span class="sd">    :param interest: Active interest from the different categories available from the Lynguo tool</span>
<span class="sd">    :return: DataFrame containing the tweets filtered by the selected interest</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">interest</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Marca&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">interest</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">interest</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Marca&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">interest</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">interest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">df</span></div>

<span class="c1"># Calculate Mentions network graph:</span>

<div class="viewcode-block" id="get_cites"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_cites">[docs]</a><span class="k">def</span> <span class="nf">get_cites</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keywords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a DataFrame containing tweets the function returns those tweets belonging to the citations type, removing the retweets.</span>
<span class="sd">    The function also applies the filtering processes</span>

<span class="sd">    :param df: DataFrame with all the tweets</span>
<span class="sd">    :param keywords: List of words acting as key to filter the DataFrame</span>
<span class="sd">    :param stopwords: List of words destined to filter out the tweets that contain them</span>
<span class="sd">    :param keywords2: List of words acting as key to filter the DataFrame according to a subtopic</span>
<span class="sd">    :param stopwords2: List of words destined to filter out the tweets that contain them according to a subtopic</span>
<span class="sd">    :param interest: Active interest from the different categories available from the Lynguo tool</span>
<span class="sd">    :return: Nested lists containing normal tweet, not retweets, and user who wrote the tweet</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_subtopic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords2</span><span class="p">,</span> <span class="n">stopwords2</span><span class="p">)</span>
    <span class="n">dfMentions</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dfMentions</span> <span class="o">=</span> <span class="n">dfMentions</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">dfEliminarRTs</span> <span class="o">=</span> <span class="n">dfMentions</span><span class="p">[</span><span class="n">dfMentions</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">)]</span>
    <span class="n">dfMentions</span> <span class="o">=</span> <span class="n">dfMentions</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">dfEliminarRTs</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">mentionsSubset</span> <span class="o">=</span> <span class="n">dfMentions</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span>
    <span class="n">mentionsList</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mentionsSubset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span>
    <span class="k">return</span> <span class="n">mentionsList</span></div>



<span class="c1"># Calculate RT network graph:</span>

<div class="viewcode-block" id="get_retweets"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_retweets">[docs]</a><span class="k">def</span> <span class="nf">get_retweets</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keywords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a DataFrame containing all the tweets the function returns all those tweets which are retweets (RT:@).</span>
<span class="sd">    It also applies the filtering procces</span>

<span class="sd">    :param df: DataFrame with all the tweets</span>
<span class="sd">    :param keywords: List of words acting as key to filter the DataFrame</span>
<span class="sd">    :param stopwords: List of words destined to filter out the tweets that contain them</span>
<span class="sd">    :param keywords2: List of words acting as key to filter the DataFrame according to a subtopic</span>
<span class="sd">    :param stopwords2: List of words destined to filter out the tweets that contain them according to a subtopic</span>
<span class="sd">    :param interest: Active interest from the different categories available from the Lynguo tool</span>
<span class="sd">    :return: Nested lists containing the retweet and the user who retweeted it</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_subtopic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords2</span><span class="p">,</span> <span class="n">stopwords2</span><span class="p">)</span>
    <span class="n">dfRT</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">,</span> <span class="s1">&#39;Fecha&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># copied to work df</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dfRT</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>  <span class="c1"># selecting rows with RT:@</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span>  <span class="c1"># date discarded</span>
    <span class="n">retweetEdges</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span>  <span class="c1"># transform to list</span>
    <span class="k">return</span> <span class="n">retweetEdges</span></div>


<span class="c1"># Function to extract as list all the types of tweets, use specially for hashtag analysis (with get_edgesMain):</span>

<div class="viewcode-block" id="get_all"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_all">[docs]</a><span class="k">def</span> <span class="nf">get_all</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keywords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a DataFrame containing all the tweets, the function returns all the tweet and the user who wrote or</span>
<span class="sd">    retweeted it in a nested list</span>

<span class="sd">    :param df: DataFrame with all the tweets</span>
<span class="sd">    :param keywords: List of words acting as key to filter the DataFrame</span>
<span class="sd">    :param stopwords: List of words destined to filter out the tweets that contain them</span>
<span class="sd">    :param keywords2: List of words acting as key to filter the DataFrame according to a subtopic</span>
<span class="sd">    :param stopwords2: List of words destined to filter out the tweets that contain them according to a subtopic</span>
<span class="sd">    :param interest: Active interest from the different categories available from the Lynguo tool</span>
<span class="sd">    :return: Nested lists containing tweet and user</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_subtopic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords2</span><span class="p">,</span> <span class="n">stopwords2</span><span class="p">)</span>
    <span class="n">df_text</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df_text</span> <span class="o">=</span> <span class="n">df_text</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">list_text</span> <span class="o">=</span> <span class="n">df_text</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">list_text</span></div>

<span class="c1"># Function to extract edges from RTs, mentions and all:</span>

<div class="viewcode-block" id="get_edges"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_edges">[docs]</a><span class="k">def</span> <span class="nf">get_edges</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of lists containing tweets or retweets and users the function returns the edges to create a network</span>

<span class="sd">    :param values: List of lists with the tweet and user</span>
<span class="sd">    :return: List of lists containing the user and the @ inside the tweet</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;@(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">reg</span><span class="p">:</span>
            <span class="n">matchRT</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Se extrae la primera mención que hace referencia a la cuenta retuiteada</span>
            <span class="c1"># row[1] = hashlib.md5(match.encode()).hexdigest()</span>
            <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchRT</span>  <span class="c1"># Convierte el nombre de la cuenta en hash y lo asigna al elemento</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">edges</span></div>


<span class="c1"># Code to create a bar graph of most used hashtags in RTs:</span>

<span class="c1"># Selection of rows only with RTs and creation of a list containing the texts:</span>


<div class="viewcode-block" id="get_hashtagsRT"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_hashtagsRT">[docs]</a><span class="k">def</span> <span class="nf">get_hashtagsRT</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keywords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a DataFrame containing all the tweets the function returns a list containing the different texts that are</span>
<span class="sd">    retweets in order to find the hashtags (#) inside them</span>

<span class="sd">    :param df: DataFrame with all the tweets</span>
<span class="sd">    :param keywords: List of words acting as key to filter the DataFrame</span>
<span class="sd">    :param stopwords: List of words destined to filter out the tweets that contain them</span>
<span class="sd">    :param keywords2: List of words acting as key to filter the DataFrame according to a subtopic</span>
<span class="sd">    :param stopwords2: List of words destined to filter out the tweets that contain them according to a subtopic</span>
<span class="sd">    :param interest: Active interest from the different categories available from the Lynguo tool</span>
<span class="sd">    :return: List with the retweets</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_subtopic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords2</span><span class="p">,</span> <span class="n">stopwords2</span><span class="p">)</span>
    <span class="n">dfHashtagsRT</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dfHashtagsRT</span> <span class="o">=</span> <span class="n">dfHashtagsRT</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">dfHashtagsRT</span> <span class="o">=</span> <span class="n">dfHashtagsRT</span><span class="p">[</span><span class="n">dfHashtagsRT</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">)]</span>
    <span class="n">listHashtagsRT</span> <span class="o">=</span> <span class="n">dfHashtagsRT</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">listHashtagsRT</span></div>

<span class="c1"># Obtain hashtags used in Text:</span>

<div class="viewcode-block" id="get_edgesHashRT"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_edgesHashRT">[docs]</a><span class="k">def</span> <span class="nf">get_edgesHashRT</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list containing retweets, the function finds all the hashtags inside the text</span>

<span class="sd">    :param values: list with the retweets</span>
<span class="sd">    :return: list with all the hashtags in these retweets</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hashtags</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">hashtags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashtag</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hashtags</span></div>

<span class="c1"># Organisation of hashtags by usage and creation of a list containing number of appearances:</span>

<div class="viewcode-block" id="prepare_hashtags"><a class="viewcode-back" href="../generate_utils.html#generate_utils.prepare_hashtags">[docs]</a><span class="k">def</span> <span class="nf">prepare_hashtags</span><span class="p">(</span><span class="n">hashtags</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of hashtags, the function returns the number of appearances of each hashtags and a list of unique hashtags</span>

<span class="sd">    :param hashtags: list of hashtags</span>
<span class="sd">    :param stopwords: Word or list of words destined to be filtered out from the list of hashtags</span>
<span class="sd">    :return: Ordered list with the number of appearances of each hashtag and a list of unique hashtags</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">citsci_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">]</span>
    <span class="n">hashtags</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">hashtags</span><span class="p">]</span>
    <span class="n">hashtags</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">hashtags</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">citsci_words</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">stopwords</span><span class="p">:</span>
        <span class="n">hashtags</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">hashtags</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="p">]</span>
    <span class="n">hashtags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">hashtags</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">hashtags</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">((</span><span class="nb">zip</span><span class="p">(</span><span class="n">hashtags</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hashtags</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sortedNumberHashtags</span><span class="p">,</span> <span class="n">sortedHashtagsRT</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">hashtags</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sortedNumberHashtags</span><span class="p">,</span> <span class="n">sortedHashtagsRT</span></div>


<span class="c1"># Code to visualise the graph of hashtags in RTs:</span>

<div class="viewcode-block" id="get_hashtagsRT2"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_hashtagsRT2">[docs]</a><span class="k">def</span> <span class="nf">get_hashtagsRT2</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keywords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a DataFrame containing all the tweets, the function returns a list of lists containing the retweets and the</span>
<span class="sd">    users who retweeted them, in order to find the hashtags inside those retweets</span>

<span class="sd">    :param df: DataFrame with all the tweets</span>
<span class="sd">    :param keywords: List of words acting as key to filter the DataFrame</span>
<span class="sd">    :param stopwords: List of words destined to filter out the tweets that contain them</span>
<span class="sd">    :param keywords2: List of words acting as key to filter the DataFrame according to a subtopic</span>
<span class="sd">    :param stopwords2: List of words destined to filter out the tweets that contain them according to a subtopic</span>
<span class="sd">    :param interest: Active interest from the different categories available from the Lynguo tool</span>
<span class="sd">    :return: List of lists, where each list contains user and retweet</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_subtopic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords2</span><span class="p">,</span> <span class="n">stopwords2</span><span class="p">)</span>
    <span class="n">dfHashtagsRT</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">dfHashtagsRT</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dfHashtagsRT</span> <span class="o">=</span> <span class="n">dfHashtagsRT</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">listHashtagsRT</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dfHashtagsRT</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span>
    <span class="k">return</span> <span class="n">listHashtagsRT</span></div>


<div class="viewcode-block" id="get_edgesHashRT2"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_edgesHashRT2">[docs]</a><span class="k">def</span> <span class="nf">get_edgesHashRT2</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of list with users and retweets, the function returns the users and the hashtags in their retweets</span>

<span class="sd">    :param values: List of lists with user and retweet</span>
<span class="sd">    :return: List of lists, where each list contains user and hashtags</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">matchHashRT</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchHashRT</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">edges</span></div>

<span class="c1">#Combination of edges of RTs and Mentions:</span>


<div class="viewcode-block" id="combined_edges"><a class="viewcode-back" href="../generate_utils.html#generate_utils.combined_edges">[docs]</a><span class="k">def</span> <span class="nf">combined_edges</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given the edges from retweets and from mentions the function combine them both</span>

<span class="sd">    :param x: Edges from retweets</span>
<span class="sd">    :param y: Edges from mentions</span>
<span class="sd">    :return: List of lists with the edges combined</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">combined_edges</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">combined_edges</span></div>


<span class="c1">## Code to show the graph of related hashtags out of RTs. Shows hashtags related to each other</span>


<div class="viewcode-block" id="get_hashtagsmain"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_hashtagsmain">[docs]</a><span class="k">def</span> <span class="nf">get_hashtagsmain</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keywords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a DataFrame containing all the tweets, the function returns a list containing all the mentions</span>
<span class="sd">    from the DataFrame</span>

<span class="sd">    :param df: DataFrame with all the tweets</span>
<span class="sd">    :param keywords: List of words acting as key to filter the DataFrame</span>
<span class="sd">    :param stopwords: List of words destined to filter out the tweets that contain them</span>
<span class="sd">    :param keywords2: List of words acting as key to filter the DataFrame according to a subtopic</span>
<span class="sd">    :param stopwords2: List of words destined to filter out the tweets that contain them according to a subtopic</span>
<span class="sd">    :param interest: Active interest from the different categories available from the Lynguo tool</span>
<span class="sd">    :return: List with all the tweets which are mentions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_subtopic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords2</span><span class="p">,</span> <span class="n">stopwords2</span><span class="p">)</span>
    <span class="n">dfMainHashtags</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dfMainHashtags</span> <span class="o">=</span> <span class="n">dfMainHashtags</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">dfMainHashtags</span><span class="p">[</span><span class="n">dfMainHashtags</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">)]</span>
    <span class="n">dfMainHashtags</span> <span class="o">=</span> <span class="n">dfMainHashtags</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">dfMainHashtags</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span>
    <span class="n">listMainHashtags</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">listMainHashtags</span></div>


<span class="sd">&quot;&quot;&quot;def mainHashtags(values):</span>
<span class="sd">    stop_words = [&#39;#citizenscience&#39;, &#39;citizenscience&#39;, &#39;rt&#39;, &#39;citizen&#39;, &#39;science&#39;, &#39;citsci&#39;, &#39;cienciaciudadana&#39;]</span>
<span class="sd">    mainHashtags = []</span>
<span class="sd">    aristasHashtags = []</span>
<span class="sd">    for row in values:</span>
<span class="sd">        match = re.findall(&#39;#(\w+)&#39;, row.lower())</span>
<span class="sd">        length = len(match)</span>
<span class="sd">    try:</span>
<span class="sd">        match = [word for word in match if word not in stop_words]</span>
<span class="sd">    except ValueError:</span>
<span class="sd">        pass</span>
<span class="sd">    for index,hashtag in enumerate(match):</span>
<span class="sd">        mainHashtags.append(hashtag)</span>
<span class="sd">        if index | (length-2):</span>
<span class="sd">            nextHashtags = match[index+1:length-1]</span>
<span class="sd">            for nextHashtags in nextHashtags:</span>
<span class="sd">                aristasHashtags.append([hashtag,nextHashtags])</span>
<span class="sd">    return aristasHashtags&quot;&quot;&quot;</span>


<span class="c1"># Creation of the graph of most used hashtags (related to user):</span>

<div class="viewcode-block" id="get_hashtagsmain2"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_hashtagsmain2">[docs]</a><span class="k">def</span> <span class="nf">get_hashtagsmain2</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keywords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a DataFrame with all the tweets, the function returns a list of list in which each list contains</span>
<span class="sd">    the user and the written tweet</span>

<span class="sd">    :param df: DataFrame with all the tweets</span>
<span class="sd">    :param keywords: List of words acting as key to filter the DataFrame</span>
<span class="sd">    :param stopwords: List of words destined to filter out the tweets that contain them</span>
<span class="sd">    :param keywords2: List of words acting as key to filter the DataFrame according to a subtopic</span>
<span class="sd">    :param stopwords2: List of words destined to filter out the tweets that contain them according to a subtopic</span>
<span class="sd">    :param interest: Active interest from the different categories available from the Lynguo tool</span>
<span class="sd">    :return: List of lists, each list contains user, written tweet</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_subtopic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords2</span><span class="p">,</span> <span class="n">stopwords2</span><span class="p">)</span>
    <span class="n">dfMainHashtags</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dfMainHashtags</span> <span class="o">=</span> <span class="n">dfMainHashtags</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">dfMainHashtags</span><span class="p">[</span><span class="n">dfMainHashtags</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">)]</span>
    <span class="n">dfMainHashtags</span> <span class="o">=</span> <span class="n">dfMainHashtags</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">dfMainHashtags</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span><span class="s1">&#39;Texto&#39;</span><span class="p">]]</span>
    <span class="n">listMainHashtags</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span>
    <span class="k">return</span> <span class="n">listMainHashtags</span></div>


<div class="viewcode-block" id="get_edgesmain2"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_edgesmain2">[docs]</a><span class="k">def</span> <span class="nf">get_edgesmain2</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of edges, the function returns the hashtags inside the tweet and relates them to the user</span>

<span class="sd">    :param values: List of lists containing the edges (user, tweet)</span>
<span class="sd">    :return: List of lists, in each list the user and the hashtag used by them is stored</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stop_words</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">,</span><span class="s1">&#39;CitizenScience&#39;</span><span class="p">]]</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">matchhash</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchhash</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">edges</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">stop_words</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">edges</span></div>

<span class="c1"># Creation of the graph of most used hashtags out of RTs(use get_hashtagsmain()):</span>

<div class="viewcode-block" id="get_edgesMain"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_edgesMain">[docs]</a><span class="k">def</span> <span class="nf">get_edgesMain</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of tweets, the function returns the hashtags inside those tweets.</span>

<span class="sd">    :param values: List of tweets</span>
<span class="sd">    :return: List with the hashtags inside the tweets</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hashtags</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">hashtags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashtag</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hashtags</span></div>

<span class="c1"># Hashtags from the Bot:</span>
<span class="n">botwords</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;airpollution&#39;</span><span class="p">,</span> <span class="s1">&#39;luftdaten&#39;</span><span class="p">,</span> <span class="s1">&#39;fijnstof&#39;</span><span class="p">,</span> <span class="s1">&#39;waalre&#39;</span><span class="p">,</span> <span class="s1">&#39;pm2&#39;</span><span class="p">,</span> <span class="s1">&#39;pm10&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="prepare_hashtagsmain"><a class="viewcode-back" href="../generate_utils.html#generate_utils.prepare_hashtagsmain">[docs]</a><span class="k">def</span> <span class="nf">prepare_hashtagsmain</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of hashtags, the function returns the number of appearances of each hashtag and a unique list of hashtags.</span>

<span class="sd">    :param list: List of hashtags</span>
<span class="sd">    :param stopwords: List of words destined to filter out the desired hashtags from the list</span>
<span class="sd">    :return: Ordered list with the number of appearances of each hashtag and a list of unique hashtags</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">citsci_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">]</span>
    <span class="n">lista</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">]</span>
    <span class="n">lista</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">lista</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">citsci_words</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">stopwords</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lista</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">lista</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="p">]</span>
    <span class="n">mainHashtags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">lista</span><span class="p">,</span><span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mainHashtags</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">((</span><span class="nb">zip</span><span class="p">(</span><span class="n">mainHashtags</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mainHashtags</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sortedNumberHashtags</span><span class="p">,</span> <span class="n">sortedMainHashtags</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">mainHashtags</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sortedNumberHashtags</span><span class="p">,</span><span class="n">sortedMainHashtags</span></div>


<span class="sd">&quot;&quot;&quot;def get_prop_type(value, key=None):</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="sd">    Performs typing and value conversion for the graph_tool PropertyMap class.</span>
<span class="sd">    If a key is provided, it also ensures the key is in a format that can be</span>
<span class="sd">    used with the PropertyMap. Returns a tuple, (type name, value, key)</span>
<span class="sd">    &#39;&#39;&#39;</span>

<span class="sd">    # Deal with the value</span>
<span class="sd">    if isinstance(value, bool):</span>
<span class="sd">        tname = &#39;bool&#39;</span>

<span class="sd">    elif isinstance(value, int):</span>
<span class="sd">        tname = &#39;float&#39;</span>
<span class="sd">        value = float(value)</span>

<span class="sd">    elif isinstance(value, float):</span>
<span class="sd">        tname = &#39;float&#39;</span>

<span class="sd">    elif isinstance(value, dict):</span>
<span class="sd">        tname = &#39;object&#39;</span>

<span class="sd">    else:</span>
<span class="sd">        tname = &#39;string&#39;</span>
<span class="sd">        value = str(value)</span>

<span class="sd">    return tname, value, key</span>


<span class="sd">def nx2gt(nxG):</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="sd">    Converts a networkx graph to a graph-tool graph.</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="sd">    # Phase 0: Create a directed or undirected graph-tool Graph</span>
<span class="sd">    gtG = gt.Graph(directed=nxG.is_directed())</span>

<span class="sd">    # Add the Graph properties as &quot;internal properties&quot;</span>
<span class="sd">    for key, value in nxG.graph.items():</span>
<span class="sd">        # Convert the value and key into a type for graph-tool</span>
<span class="sd">        tname, value, key = get_prop_type(value, key)</span>

<span class="sd">        prop = gtG.new_graph_property(tname)  # Create the PropertyMap</span>
<span class="sd">        gtG.graph_properties[key] = prop      # Set the PropertyMap</span>
<span class="sd">        gtG.graph_properties[key] = value     # Set the actual value</span>

<span class="sd">    # Phase 1: Add the vertex and edge property maps</span>
<span class="sd">    # Go through all nodes and edges and add seen properties</span>
<span class="sd">    # Add the node properties first</span>
<span class="sd">    nprops = set()  # cache keys to only add properties once</span>
<span class="sd">    for node, data in nxG.nodes(data=True):</span>

<span class="sd">        # Go through all the properties if not seen and add them.</span>
<span class="sd">        for key, val in data.items():</span>
<span class="sd">            if key in nprops:</span>
<span class="sd">                continue  # Skip properties already added</span>

<span class="sd">            # Convert the value and key into a type for graph-tool</span>
<span class="sd">            tname, _, key = get_prop_type(val, key)</span>

<span class="sd">            prop = gtG.new_vertex_property(tname)  # Create the PropertyMap</span>
<span class="sd">            gtG.vertex_properties[key] = prop      # Set the PropertyMap</span>

<span class="sd">            # Add the key to the already seen properties</span>
<span class="sd">            nprops.add(key)</span>

<span class="sd">    # Also add the node id: in NetworkX a node can be any hashable type, but</span>
<span class="sd">    # in graph-tool node are defined as indices. So we capture any strings</span>
<span class="sd">    # in a special PropertyMap called &#39;id&#39; -- modify as needed!</span>
<span class="sd">    gtG.vertex_properties[&#39;id&#39;] = gtG.new_vertex_property(&#39;string&#39;)</span>

<span class="sd">    # Add the edge properties second</span>
<span class="sd">    eprops = set()  # cache keys to only add properties once</span>
<span class="sd">    for src, dst, data in nxG.edges(data=True):</span>

<span class="sd">        # Go through all the edge properties if not seen and add them.</span>
<span class="sd">        for key, val in data.items():</span>
<span class="sd">            if key in eprops:</span>
<span class="sd">                continue  # Skip properties already added</span>

<span class="sd">            # Convert the value and key into a type for graph-tool</span>
<span class="sd">            tname, _, key = get_prop_type(val, key)</span>

<span class="sd">            prop = gtG.new_edge_property(tname)  # Create the PropertyMap</span>
<span class="sd">            gtG.edge_properties[key] = prop      # Set the PropertyMap</span>

<span class="sd">            # Add the key to the already seen properties</span>
<span class="sd">            eprops.add(key)</span>

<span class="sd">    # Phase 2: Actually add all the nodes and vertices with their properties</span>
<span class="sd">    # Add the nodes</span>
<span class="sd">    vertices = {}  # vertex mapping for tracking edges later</span>
<span class="sd">    for node, data in nxG.nodes(data=True):</span>

<span class="sd">        # Create the vertex and annotate for our edges later</span>
<span class="sd">        v = gtG.add_vertex()</span>
<span class="sd">        vertices[node] = v</span>

<span class="sd">        # Set the vertex properties, not forgetting the id property</span>
<span class="sd">        data[&#39;id&#39;] = str(node)</span>
<span class="sd">        for key, value in data.items():</span>
<span class="sd">            gtG.vp[key][v] = value  # vp is short for vertex_properties</span>

<span class="sd">    # Add the edges</span>
<span class="sd">    for src, dst, data in nxG.edges(data=True):</span>

<span class="sd">        # Look up the vertex structs from our vertices mapping and add edge.</span>
<span class="sd">        e = gtG.add_edge(vertices[src], vertices[dst])</span>

<span class="sd">        # Add the edge properties</span>
<span class="sd">        for key, value in data.items():</span>
<span class="sd">            gtG.ep[key][e] = value  # ep is short for edge_properties</span>

<span class="sd">    # Done, finally!</span>
<span class="sd">    return gtG&quot;&quot;&quot;</span>

<span class="c1"># Función para extraer los valores de degree,outdegree, eigenvector y betweenness y crear un csv:</span>

<div class="viewcode-block" id="get_degrees"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_degrees">[docs]</a><span class="k">def</span> <span class="nf">get_degrees</span><span class="p">(</span><span class="n">G</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a Networkx directed graph, the function returns a CSV file containing the centrality measures of</span>
<span class="sd">    the graph (Indegree, Outdegree, Betweenness and Eigenvector) sorted by indegree</span>

<span class="sd">    :param G: Networkx directed graph</span>
<span class="sd">    :return: Dataframe with the users, centrality measures and rank based of those measures, sorted by the indegree</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">networkit</span> <span class="k">as</span> <span class="nn">nk</span>
    <span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
    <span class="n">n_g</span> <span class="o">=</span> <span class="n">nk</span><span class="o">.</span><span class="n">nxadapter</span><span class="o">.</span><span class="n">nx2nk</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
    <span class="n">idmap</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">u</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(),</span> <span class="nb">range</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">())))</span>
    <span class="n">btwn</span> <span class="o">=</span> <span class="n">nk</span><span class="o">.</span><span class="n">centrality</span><span class="o">.</span><span class="n">Betweenness</span><span class="p">(</span><span class="n">n_g</span><span class="p">)</span>
    <span class="n">ec</span> <span class="o">=</span> <span class="n">nk</span><span class="o">.</span><span class="n">centrality</span><span class="o">.</span><span class="n">EigenvectorCentrality</span><span class="p">(</span><span class="n">n_g</span><span class="p">)</span>
    <span class="n">ec</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">btwn</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">bt_results</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">btwn</span><span class="o">.</span><span class="n">ranking</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">bt_results</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">id_</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">bt_results</span><span class="p">]</span>
    <span class="n">ec_results</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ec</span><span class="o">.</span><span class="n">ranking</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">ec_results</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">id_</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">ec_results</span><span class="p">]</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">in_degrees</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">out_degrees</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">n_g</span><span class="o">.</span><span class="n">iterNodes</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idmap</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="n">in_degrees</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_g</span><span class="o">.</span><span class="n">degreeIn</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="n">out_degrees</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_g</span><span class="o">.</span><span class="n">degreeOut</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">names</span><span class="p">,</span> <span class="s2">&quot;InD.&quot;</span><span class="p">:</span> <span class="n">in_degrees</span><span class="p">,</span> <span class="s2">&quot;OutD.&quot;</span><span class="p">:</span> <span class="n">out_degrees</span><span class="p">,</span> <span class="s2">&quot;Eigen C.&quot;</span><span class="p">:</span> <span class="n">ec_results</span><span class="p">,</span> <span class="s2">&quot;Betweenness C&quot;</span><span class="p">:</span> <span class="n">bt_results</span><span class="p">})</span></div>

<span class="sd">&quot;&quot;&quot;def csv_degval(Digraph, filename):</span>
<span class="sd">    list_values = []</span>
<span class="sd">    outdegrees2 = dict(Digraph.out_degree())</span>
<span class="sd">    indegrees = dict(Digraph.in_degree())</span>
<span class="sd">    centrality = dict(nx.eigenvector_centrality(Digraph))</span>
<span class="sd">    betweenness = dict(nx.betweenness_centrality(Digraph))</span>
<span class="sd">    indegtupl = sorted([(k, v) for k, v in indegrees.items()], key=lambda x:x[1], reverse=True)</span>
<span class="sd">    indegtupl = indegtupl[0:10]</span>
<span class="sd">    names = [i[0] for i in indegtupl]</span>
<span class="sd">    outdegtupl = sorted([(k,v) for k,v in outdegrees2.items()], key=lambda x:x[1], reverse=True)</span>
<span class="sd">    centraltupl = sorted([(k,v) for k,v in centrality.items()], key=lambda x:x[1], reverse=True)</span>
<span class="sd">    betwentupl = sorted([(k,v) for k,v in betweenness.items()], key=lambda x:x[1], reverse=True)</span>
<span class="sd">    for name in names:</span>
<span class="sd">        pos_indeg = [y[0] for y in indegtupl].index(name)</span>
<span class="sd">        rank_indeg = pos_indeg + 1</span>
<span class="sd">        indeg_val = indegtupl[pos_indeg][1]</span>
<span class="sd">        pos_outdeg = [y[0] for y in outdegtupl].index(name)</span>
<span class="sd">        rank_outdeg = pos_outdeg + 1</span>
<span class="sd">        outdeg_val = outdegtupl[pos_outdeg][1]</span>
<span class="sd">        pos_central = [y[0] for y in centraltupl].index(name)</span>
<span class="sd">        rank_central = pos_central + 1</span>
<span class="sd">        central_val = centraltupl[pos_central][1]</span>
<span class="sd">        central_val = round(centraltupl[pos_central][1],6)</span>
<span class="sd">        pos_between = [y[0] for y in betwentupl].index(name)</span>
<span class="sd">        rank_between = pos_between + 1</span>
<span class="sd">        between_val = round(betwentupl[pos_between][1], 6)</span>
<span class="sd">        list_values.append((name, indeg_val, rank_indeg, outdeg_val, rank_outdeg, central_val, rank_central,</span>
<span class="sd">                        between_val, rank_between))</span>
<span class="sd">    df = pd.DataFrame(list_values,</span>
<span class="sd">                      columns=[&#39;Name&#39;, &#39;Indegree&#39;, &#39;R.In&#39;, &#39;Outdegree&#39;, &#39;R.Out&#39;, &#39;Eigenvector&#39;, &#39;R.EI&#39;, &#39;Betweenness&#39;,</span>
<span class="sd">                               &#39;R.Bet&#39;])</span>
<span class="sd">    return df&quot;&quot;&quot;</span>

<span class="c1">## Functions to obtain elements for two mode:</span>
<span class="c1"># RTs:</span>

<div class="viewcode-block" id="get_twomodeRT"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_twomodeRT">[docs]</a><span class="k">def</span> <span class="nf">get_twomodeRT</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keywords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a DataFrame containing al the tweets, the function returns a bipartite graph with the users and the</span>
<span class="sd">    retweets as nodes. The retweets are displayed as weighted nodes</span>

<span class="sd">    :param df: DataFrame with all the tweets</span>
<span class="sd">    :param keywords: List of words acting as key to filter the DataFrame</span>
<span class="sd">    :param stopwords: List of words destined to filter out the tweets that contain them</span>
<span class="sd">    :param keywords2: List of words acting as key to filter the DataFrame according to a subtopic</span>
<span class="sd">    :param stopwords2: List of words destined to filter out the tweets that contain them according to a subtopic</span>
<span class="sd">    :param interest: Active interest from the different categories available from the Lynguo tool</span>
<span class="sd">    :return: Networkx bipartite graph</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_subtopic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords2</span><span class="p">,</span> <span class="n">stopwords2</span><span class="p">)</span>
    <span class="n">dfRT</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dfRT</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="n">u</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">])</span>
    <span class="n">v</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">])</span>
    <span class="n">edges_tuple</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
    <span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">bipartite</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">bipartite</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">v</span><span class="p">})</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">edges_tuple</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2000</span><span class="p">:</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">k_core</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">k_core</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">list</span><span class="p">((</span><span class="n">nx</span><span class="o">.</span><span class="n">core_number</span><span class="p">(</span><span class="n">G</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">pos</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">u</span><span class="p">)))</span>
    <span class="n">pos</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">G</span></div>

<span class="c1"># Obtaining components for two mode for hashtags outside RTs:</span>

<div class="viewcode-block" id="get_twomodeHashMain"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_twomodeHashMain">[docs]</a><span class="k">def</span> <span class="nf">get_twomodeHashMain</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keywords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filter_hashtags</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a DataFrame with all the tweets, the function returns a networkx bipartite graph with</span>
<span class="sd">    the users and hashtags (outside retweets) as nodes</span>

<span class="sd">    :param df: DataFrame with all the tweets</span>
<span class="sd">    :param keywords: List of words acting as key to filter the DataFrame</span>
<span class="sd">    :param stopwords: List of words destined to filter out the tweets that contain them</span>
<span class="sd">    :param keywords2: List of words acting as key to filter the DataFrame according to a subtopic</span>
<span class="sd">    :param stopwords2: List of words destined to filter out the tweets that contain them according to a subtopic</span>
<span class="sd">    :param interest: Active interest from the different categories available from the Lynguo tool</span>
<span class="sd">    :param filter_hashtags: Boolean, to remove the predefined citizen science most common hashtags</span>
<span class="sd">    :return: Networkx bipartite graph</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_subtopic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords2</span><span class="p">,</span> <span class="n">stopwords2</span><span class="p">)</span>
    <span class="n">dfMain</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dfMain</span> <span class="o">=</span> <span class="n">dfMain</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">dfEliminarRTs</span> <span class="o">=</span> <span class="n">dfMain</span><span class="p">[</span><span class="n">dfMain</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">)]</span>
    <span class="n">dfMain</span> <span class="o">=</span> <span class="n">dfMain</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">dfEliminarRTs</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">dfMain</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="n">listHT</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span>
    <span class="n">stop_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CitizenScience &#39;</span><span class="p">,</span><span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">,</span><span class="s1">&#39;CitizenScience&#39;</span><span class="p">]</span>

    <span class="n">filter_edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">listHT</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">matchhash</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchhash</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filter_hashtags</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">edge</span><span class="p">:</span>
                <span class="c1"># print(word, word.lower() in stop_words)</span>
                <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">stop_words</span><span class="p">:</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">stop</span><span class="p">:</span>
                <span class="n">filter_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filter_hashtags</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">filter_edges</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">filter_edges</span><span class="p">]</span>
        <span class="n">edges_tuple</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">filter_edges</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">]</span>
        <span class="n">edges_tuple</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">]</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
    <span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">bipartite</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">bipartite</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">v</span><span class="p">})</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">edges_tuple</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">))</span>
    <span class="n">G</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">selfloop_edges</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2000</span><span class="p">:</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">k_core</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">k_core</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">list</span><span class="p">((</span><span class="n">nx</span><span class="o">.</span><span class="n">core_number</span><span class="p">(</span><span class="n">G</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">pos</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">u</span><span class="p">)))</span>
    <span class="n">pos</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">G</span></div>

<span class="c1"># Function to obtain the components for the two mode for hashtags in RTs:</span>

<div class="viewcode-block" id="get_twomodeHashRT"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_twomodeHashRT">[docs]</a><span class="k">def</span> <span class="nf">get_twomodeHashRT</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keywords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filter_hashtags</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     Given a DataFrame with all the tweets, the function returns a networkx bipartite graph with the</span>
<span class="sd">     users and hashtags (inside retweets) as nodes</span>

<span class="sd">    :param df: DataFrame with all the tweets</span>
<span class="sd">    :param keywords: List of words acting as key to filter the DataFrame</span>
<span class="sd">    :param stopwords: List of words destined to filter out the tweets that contain them</span>
<span class="sd">    :param keywords2: List of words acting as key to filter the DataFrame according to a subtopic</span>
<span class="sd">    :param stopwords2: List of words destined to filter out the tweets that contain them according to a subtopic</span>
<span class="sd">    :param interest: Active interest from the different categories available from the Lynguo tool</span>
<span class="sd">    :param filter_hashtags: Boolean, to remove the predefined citizen science most common hashtags</span>
<span class="sd">    :return: Networkx bipartite graph</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_subtopic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords2</span><span class="p">,</span> <span class="n">stopwords2</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dfRT</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>  <span class="c1"># Se seleccionan sólo las filas conpython  RT</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span>
    <span class="n">listHT</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stop_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CitizenScience&#39;</span><span class="p">,</span> <span class="s1">&#39;citizenScience&#39;</span><span class="p">,</span><span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">,</span> <span class="s1">&#39;#CitizenScience&#39;</span><span class="p">]</span>
    <span class="n">filter_edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">listHT</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">matchhash</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchhash</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filter_hashtags</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
           <span class="n">stop</span> <span class="o">=</span> <span class="kc">False</span>
           <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">edge</span><span class="p">:</span>
               <span class="c1">#print(word, word.lower() in stop_words)</span>
                <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">stop_words</span><span class="p">:</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span>
           <span class="k">if</span> <span class="ow">not</span> <span class="n">stop</span><span class="p">:</span>
               <span class="n">filter_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filter_hashtags</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">filter_edges</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">filter_edges</span><span class="p">]</span>
        <span class="n">edges_tuple</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">filter_edges</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">]</span>
        <span class="n">edges_tuple</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">]</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
    <span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">bipartite</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">bipartite</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">v</span><span class="p">})</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">edges_tuple</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">))</span>
    <span class="n">G</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">selfloop_edges</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2000</span><span class="p">:</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">k_core</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">k_core</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">list</span><span class="p">((</span><span class="n">nx</span><span class="o">.</span><span class="n">core_number</span><span class="p">(</span><span class="n">G</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">pos</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">u</span><span class="p">)))</span>
    <span class="n">pos</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">G</span></div>

<span class="c1"># Wordcloud function for main hashtags:</span>

<div class="viewcode-block" id="wordcloudmain"><a class="viewcode-back" href="../generate_utils.html#generate_utils.wordcloudmain">[docs]</a><span class="k">def</span> <span class="nf">wordcloudmain</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       Given a DataFrame containing all the tweets, the function returns a wordcloud with the hashtags</span>
<span class="sd">       (outside retweets) displayed by frequency</span>

<span class="sd">       :param df: DataFrame with all the tweets</span>
<span class="sd">       :param keywords: List of words acting as key to filter the DataFrame</span>
<span class="sd">       :param stopwords: List of words destined to filter out the tweets that contain them</span>
<span class="sd">       :param keywords2: List of words acting as key to filter the DataFrame according to a subtopic</span>
<span class="sd">       :param stopwords2: List of words destined to filter out the tweets that contain them according to a subtopic</span>
<span class="sd">       :param interest: Active interest from the different categories available from the Lynguo tool</span>
<span class="sd">       :return: Wordcloud with the hashtags by frequency</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="n">hashtags</span> <span class="o">=</span><span class="p">[]</span>
    <span class="n">stop_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">,</span> <span class="s1">&#39;CitizenScience&#39;</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">)]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">hashtags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashtag</span><span class="p">)</span>
    <span class="n">unique_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hashtags</span><span class="p">)</span>
    <span class="n">wordcloud</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="n">stop_words</span><span class="p">,</span>
                          <span class="n">min_font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_words</span><span class="o">=</span><span class="mi">10405</span><span class="p">,</span> <span class="n">collocations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;winter&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">unique_string</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordcloud</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;wc.png&quot;</span><span class="p">)</span></div>

<span class="c1"># Wordcloud for main hashtags plotted inside a logo:</span>

<div class="viewcode-block" id="transform_format"><a class="viewcode-back" href="../generate_utils.html#generate_utils.transform_format">[docs]</a><span class="k">def</span> <span class="nf">transform_format</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">255</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">val</span></div>


<div class="viewcode-block" id="wordcloud_mainhtlogo"><a class="viewcode-back" href="../generate_utils.html#generate_utils.wordcloud_mainhtlogo">[docs]</a><span class="k">def</span> <span class="nf">wordcloud_mainhtlogo</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keywords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a DataFrame containing all the tweets, the function returns a wordcloud with the hashtags</span>
<span class="sd">    (outside retweets) displayed by frequency</span>

<span class="sd">    :param df: DataFrame with all the tweets</span>
<span class="sd">    :param keywords: List of words acting as key to filter the DataFrame</span>
<span class="sd">    :param stopwords: List of words destined to filter out the tweets that contain them</span>
<span class="sd">    :param keywords2: List of words acting as key to filter the DataFrame according to a subtopic</span>
<span class="sd">    :param stopwords2: List of words destined to filter out the tweets that contain them according to a subtopic</span>
<span class="sd">    :param interest: Active interest from the different categories available from the Lynguo tool</span>
<span class="sd">    :param image: Image file to plot the wordcloud inside</span>
<span class="sd">    :return: Wordcloud inside desired image with the hashtags by frequency</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hashtags</span> <span class="o">=</span><span class="p">[]</span>
    <span class="n">stop_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">,</span> <span class="s1">&#39;CitizenScience&#39;</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_subtopic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords2</span><span class="p">,</span> <span class="n">stopwords2</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">)]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">hashtags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashtag</span><span class="p">)</span>
    <span class="n">unique_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hashtags</span><span class="p">)</span>
    <span class="n">logo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
    <span class="n">transformed_logo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">((</span><span class="n">logo</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">logo</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">logo</span><span class="p">)):</span>
        <span class="n">transformed_logo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">transform_format</span><span class="p">,</span> <span class="n">logo</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="n">wc</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>
                <span class="n">background_color</span> <span class="o">=</span><span class="s1">&#39;ghostwhite&#39;</span><span class="p">,</span>
                <span class="n">stopwords</span> <span class="o">=</span> <span class="n">stop_words</span><span class="p">,</span>
                <span class="n">min_font_size</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">max_font_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">max_words</span><span class="o">=</span><span class="mi">10405</span><span class="p">,</span> <span class="n">collocations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">transformed_logo</span><span class="p">,</span>
          <span class="n">contour_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">contour_color</span><span class="o">=</span><span class="s1">&#39;cornflowerblue&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;summer&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">unique_string</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wc</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<span class="c1"># Wordlcoud for hashtags in the RTs:</span>

<div class="viewcode-block" id="wordcloudRT"><a class="viewcode-back" href="../generate_utils.html#generate_utils.wordcloudRT">[docs]</a><span class="k">def</span> <span class="nf">wordcloudRT</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keywords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a DataFrame containing all the tweets, the function returns a wordcloud with the hashtags</span>
<span class="sd">    (inside retweets) displayed by frequency</span>

<span class="sd">    :param df: DataFrame with all the tweets</span>
<span class="sd">    :param keywords: List of words acting as key to filter the DataFrame</span>
<span class="sd">    :param stopwords: List of words destined to filter out the tweets that contain them</span>
<span class="sd">    :param keywords2: List of words acting as key to filter the DataFrame according to a subtopic</span>
<span class="sd">    :param stopwords2: List of words destined to filter out the tweets that contain them according to a subtopic</span>
<span class="sd">    :param interest: Active interest from the different categories available from the Lynguo tool</span>
<span class="sd">    :return: Wordcloud with the hashtags by frequency</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hashtags</span> <span class="o">=</span><span class="p">[]</span>
    <span class="n">stop_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">,</span> <span class="s1">&#39;CitizenScience&#39;</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_subtopic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords2</span><span class="p">,</span> <span class="n">stopwords2</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">hashtags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashtag</span><span class="p">)</span>
    <span class="n">unique_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hashtags</span><span class="p">)</span>
    <span class="n">wordcloud</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="n">stop_words</span><span class="p">,</span>
                          <span class="n">min_font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_words</span><span class="o">=</span><span class="mi">10405</span><span class="p">,</span> <span class="n">collocations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;winter&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">unique_string</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordcloud</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="wordcloudRT_logo"><a class="viewcode-back" href="../generate_utils.html#generate_utils.wordcloudRT_logo">[docs]</a><span class="k">def</span> <span class="nf">wordcloudRT_logo</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keywords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a DataFrame containing all the tweets, the function returns a wordcloud with the hashtags</span>
<span class="sd">    (inside retweets) displayed by frequency</span>

<span class="sd">    :param df: DataFrame with all the tweets</span>
<span class="sd">    :param keywords: List of words acting as key to filter the DataFrame</span>
<span class="sd">    :param stopwords: List of words destined to filter out the tweets that contain them</span>
<span class="sd">    :param keywords2: List of words acting as key to filter the DataFrame according to a subtopic</span>
<span class="sd">    :param stopwords2: List of words destined to filter out the tweets that contain them according to a subtopic</span>
<span class="sd">    :param interest: Active interest from the different categories available from the Lynguo tool</span>
<span class="sd">    :param image: Image file to plot the wordcloud inside</span>
<span class="sd">    :return: Wordcloud inside desired image with the hashtags by frequency</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hashtags</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stop_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">,</span> <span class="s1">&#39;CitizenScience&#39;</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_subtopic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords2</span><span class="p">,</span> <span class="n">stopwords2</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">hashtags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashtag</span><span class="p">)</span>
    <span class="n">unique_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hashtags</span><span class="p">)</span>

    <span class="n">logo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
    <span class="n">transformed_logo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">((</span><span class="n">logo</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">logo</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">logo</span><span class="p">)):</span>
        <span class="n">transformed_logo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">transform_format</span><span class="p">,</span> <span class="n">logo</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="n">wc</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
                   <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;ghostwhite&#39;</span><span class="p">,</span>
                   <span class="n">stopwords</span><span class="o">=</span><span class="n">stop_words</span><span class="p">,</span>
                   <span class="n">min_font_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_font_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">max_words</span><span class="o">=</span><span class="mi">10405</span><span class="p">,</span> <span class="n">collocations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">transformed_logo</span><span class="p">,</span>
                   <span class="n">contour_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">contour_color</span><span class="o">=</span><span class="s1">&#39;cornflowerblue&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;summer&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
        <span class="n">unique_string</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wc</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<span class="c1"># Cálculo de las palabras más usadas:</span>
<span class="c1"># La función emplea la columna texto y podemos añadir un número n que indica cuantas palabras</span>

<span class="c1"># Calculation of most used words:</span>
<span class="c1"># The function uses the column Text, we can select the number of words plotted:</span>

<div class="viewcode-block" id="most_common"><a class="viewcode-back" href="../generate_utils.html#generate_utils.most_common">[docs]</a><span class="k">def</span> <span class="nf">most_common</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keywords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a DataFrame containing all the tweets, the function returns a dictionary with the most used words and</span>
<span class="sd">    the number of appearances, a list of these words and a list with the number of times these words appear</span>

<span class="sd">    :param df: DataFrame with all the tweets</span>
<span class="sd">    :param keywords: List of words acting as key to filter the DataFrame</span>
<span class="sd">    :param stopwords: List of words destined to filter out the tweets that contain them</span>
<span class="sd">    :param keywords2: List of words acting as key to filter the DataFrame according to a subtopic</span>
<span class="sd">    :param stopwords2: List of words destined to filter out the tweets that contain them according to a subtopic</span>
<span class="sd">    :param interest: Active interest from the different categories available from the Lynguo tool</span>
<span class="sd">    :return: Tuples dict containing word and number of times, list with the words and list with the times these words appear</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_subtopic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords2</span><span class="p">,</span> <span class="n">stopwords2</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">words</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">pos_tag</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">tagset</span><span class="o">=</span><span class="s1">&#39;universal&#39;</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s1">&#39;eng&#39;</span><span class="p">)</span>
    <span class="n">word_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">token</span> <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NOUN&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;VERB&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ADJ&#39;</span><span class="p">)]</span>

    <span class="n">words</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">word_list</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;\A[a-z-A-Z]+&quot;</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
        <span class="k">for</span> <span class="nb">object</span> <span class="ow">in</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

    <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;htt(\w+)&#39;</span><span class="p">)</span>

    <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">word</span><span class="p">)]</span>

    <span class="n">count_word</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;spanish&#39;</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">STOPWORDS</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;german&#39;</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span>
    <span class="n">new_elements</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;¿&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;that?s&#39;</span><span class="p">,</span> <span class="s1">&#39;??&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">,</span> <span class="s1">&#39;we?re&#39;</span><span class="p">,</span> <span class="s1">&#39;everyone?s&#39;</span><span class="p">,</span>
    <span class="s1">&#39;supporters?&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;here:&#39;</span><span class="p">,</span> <span class="s1">&#39;science,&#39;</span><span class="p">,</span> <span class="s1">&#39;project.&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;us&#39;</span><span class="p">,</span> <span class="s1">&#39;student?&#39;</span><span class="p">,</span> <span class="s1">&#39;centre?&#39;</span><span class="p">,</span> <span class="s1">&#39;science?&#39;</span><span class="p">,</span>
    <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;media?)&#39;</span><span class="p">,</span> <span class="s1">&#39;education?&#39;</span><span class="p">,</span> <span class="s1">&#39;reuse,&#39;</span><span class="p">,</span> <span class="s1">&#39;older!&#39;</span><span class="p">,</span> <span class="s1">&#39;scientists?&#39;</span><span class="p">,</span> <span class="s1">&#39;don?t&#39;</span><span class="p">,</span> <span class="s1">&#39;it?s&#39;</span><span class="p">,</span> <span class="s1">&#39;i?m&#39;</span><span class="p">,</span> <span class="s1">&#39;w/&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;more:&#39;</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_elements</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">stopset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">stopset</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">count_word</span><span class="p">[</span><span class="n">word</span><span class="p">]</span>

    <span class="n">tuples_dict</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">count_word</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">words_pt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">numbers_pt</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="nb">tuple</span> <span class="ow">in</span> <span class="n">tuples_dict</span><span class="p">:</span>
        <span class="n">words_pt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">numbers_pt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">tuples_dict</span><span class="p">,</span> <span class="n">words_pt</span><span class="p">,</span> <span class="n">numbers_pt</span></div>


<span class="c1"># Top palabras más usadas en wordcloud:</span>

<div class="viewcode-block" id="most_commonwc"><a class="viewcode-back" href="../generate_utils.html#generate_utils.most_commonwc">[docs]</a><span class="k">def</span> <span class="nf">most_commonwc</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keywords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a DataFrame containing all the tweets, the function returns a wordcloud with the most used words in these tweets</span>

<span class="sd">    :param df: DataFrame with all the tweets</span>
<span class="sd">    :param keywords: List of words acting as key to filter the DataFrame</span>
<span class="sd">    :param stopwords: List of words destined to filter out the tweets that contain them</span>
<span class="sd">    :param keywords2: List of words acting as key to filter the DataFrame according to a subtopic</span>
<span class="sd">    :param stopwords2: List of words destined to filter out the tweets that contain them according to a subtopic</span>
<span class="sd">    :param interest: Active interest from the different categories available from the Lynguo tool</span>
<span class="sd">    :return: Wordcloud with the most used words displayed in it</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_subtopic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords2</span><span class="p">,</span> <span class="n">stopwords2</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">words</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">pos_tag</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">tagset</span><span class="o">=</span><span class="s1">&#39;universal&#39;</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s1">&#39;eng&#39;</span><span class="p">)</span>
    <span class="n">word_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">token</span> <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NOUN&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;VERB&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ADJ&#39;</span><span class="p">)]</span>

    <span class="n">words</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">word_list</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;\A[a-z-A-Z]+&quot;</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
        <span class="k">for</span> <span class="nb">object</span> <span class="ow">in</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

    <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;htt(\w+)&#39;</span><span class="p">)</span>

    <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">word</span><span class="p">)]</span>

    <span class="n">count_word</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;spanish&#39;</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">STOPWORDS</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;german&#39;</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span>
    <span class="n">new_elements</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;¿&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;that?s&#39;</span><span class="p">,</span> <span class="s1">&#39;??&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">,</span> <span class="s1">&#39;we?re&#39;</span><span class="p">,</span> <span class="s1">&#39;everyone?s&#39;</span><span class="p">,</span>
    <span class="s1">&#39;supporters?&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;here:&#39;</span><span class="p">,</span> <span class="s1">&#39;science,&#39;</span><span class="p">,</span> <span class="s1">&#39;project.&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;us&#39;</span><span class="p">,</span> <span class="s1">&#39;student?&#39;</span><span class="p">,</span> <span class="s1">&#39;centre?&#39;</span><span class="p">,</span> <span class="s1">&#39;science?&#39;</span><span class="p">,</span>
    <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;media?)&#39;</span><span class="p">,</span> <span class="s1">&#39;education?&#39;</span><span class="p">,</span> <span class="s1">&#39;reuse,&#39;</span><span class="p">,</span> <span class="s1">&#39;older!&#39;</span><span class="p">,</span> <span class="s1">&#39;scientists?&#39;</span><span class="p">,</span> <span class="s1">&#39;don?t&#39;</span><span class="p">,</span> <span class="s1">&#39;it?s&#39;</span><span class="p">,</span> <span class="s1">&#39;i?m&#39;</span><span class="p">,</span> <span class="s1">&#39;w/&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;more:&#39;</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_elements</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">stopset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">stopset</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">count_word</span><span class="p">[</span><span class="n">word</span><span class="p">]</span>

    <span class="n">wordcloud</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="n">stopset</span><span class="p">,</span>
                          <span class="n">min_font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_words</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">collocations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;winter&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">generate_from_frequencies</span><span class="p">(</span><span class="n">count_word</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordcloud</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span></div>

<div class="viewcode-block" id="sentiment_analyser"><a class="viewcode-back" href="../generate_utils.html#generate_utils.sentiment_analyser">[docs]</a><span class="k">def</span> <span class="nf">sentiment_analyser</span><span class="p">(</span><span class="n">df_entry</span><span class="p">,</span><span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a DataFrame containing all the tweets,the function returns a CSV containing the user and the score</span>
<span class="sd">        for each tweet from Vader sentiment</span>

<span class="sd">        :param df_entry: A DataFrame containing all the tweets</span>
<span class="sd">        :param keywords: List of words acting as key to filter the DataFrame</span>
<span class="sd">        :param stopwords: List of words destined to filter out the tweets that contain them</span>
<span class="sd">        :param interest: Active interest from the different categories available from the Lynguo tool</span>
<span class="sd">        :return: CSV with the columns User, Text and Sentiment</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">analyser</span> <span class="o">=</span> <span class="n">SentimentIntensityAnalyzer</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df_entry</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Texto&#39;</span><span class="p">,</span> <span class="s1">&#39;Usuario&#39;</span><span class="p">]]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">Users</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">]</span>
    <span class="n">Texto</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span>
    <span class="n">sentences</span> <span class="o">=</span> <span class="n">Texto</span>
    <span class="n">list_of_dicts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">:</span>
        <span class="n">adict</span> <span class="o">=</span> <span class="n">analyser</span><span class="o">.</span><span class="n">polarity_scores</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">adict</span><span class="p">)</span>
        <span class="n">list_of_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adict</span><span class="p">)</span>
    <span class="n">df_sentiment</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">list_of_dicts</span><span class="p">)</span>
    <span class="n">df_sentiment</span><span class="p">[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Users</span>
    <span class="n">df_sentiment</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Texto</span>
    <span class="k">return</span> <span class="n">df_sentiment</span></div>

<span class="c1">#Función para extraer los días:</span>
<div class="viewcode-block" id="getDays"><a class="viewcode-back" href="../generate_utils.html#generate_utils.getDays">[docs]</a><span class="k">def</span> <span class="nf">getDays</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Fecha&#39;</span><span class="p">]</span>
    <span class="n">days</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">days</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">days</span></div>

<div class="viewcode-block" id="make_weightedDiGraph"><a class="viewcode-back" href="../generate_utils.html#generate_utils.make_weightedDiGraph">[docs]</a><span class="k">def</span> <span class="nf">make_weightedDiGraph</span><span class="p">(</span><span class="n">ejes</span><span class="p">):</span>
    <span class="n">edges_tupla</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ejes</span><span class="p">]</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">v</span><span class="p">})</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">edges_tupla</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">G</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, David Roldan and Fernando Martinez.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>